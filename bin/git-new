#!/bin/bash
# new [developments|common/release] branch
[ -z "$BASH_LIB" ] && echo "bashLib path not found" && exit 1
[ ! -e "$BASH_LIB/lib/helper.inc.sh" ] && echo "helper.inc.sh not found" && exit 1
[ -e "$BASH_LIB/lib/helper.inc.sh" ] && source "$BASH_LIB/lib/helper.inc.sh"

f() {
  local dir="${1:-dev}"
  shift
  local d="./" date_format="+%s" here="`basename $(pwd)`"

  case "$here" in
    billing-manager) date_format="+%Y-%m-%d";;
    rest-billing-dev|rest-billing-rc|notification) date_format="+%Y%m%d";;
  esac

  local b="${@}" date="`date "$date_format"`"
  [ -z "$dir" -o -z "$b" ] && quit 'I need 2 args : "dir" and "branch name"'
  case $dir in 
    dev) d='developments/'${date}_${b// /_} ;;
    rel) d='common/release/'${b// /_} ;;
    *)   quit "'$dir' : bad value for directory (only 'dev' & 'rel' are allowed)"; exit 1 ;;

  esac 
  git checkout -b $d
}

f $@
